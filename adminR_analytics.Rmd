---
title: "adminrR Meetup Analytics"
author: "Andrea Schnell"
---


```{r}
library(meetupr)
library(tidyverse)
library(magrittr)
library(tidytext)

Sys.setenv(MEETUP_KEY = "36b7c9452951431a434a33123e42f")

urlname <- "adminR"
(events <- get_events(urlname))

adminr_members <- get_members("adminR")

adminr_guests <- get_event_rsvps("adminR", "253930551") 

%>% filter(response == "yes")

n_members <- adminr_members$id

purrr::map()


mem_list <- adminr_members$resource %>% unlist(.$group_profile) %>% data_frame() %>% select(group_profile.answers.answer)
names(mem_list)


%>% filter(id == 189064954)



adminr_members$resource[[91]]$group_profile$answers[[1]]$answer

adminr_members$resource[[91]]$group_profile$answers[[2]]$answer


str(adminr_members$resource)
```


# City
```{r}
adminr_members %>% 
  left_join(., adminr_guests, by = c('id' = 'member_id')) %>% 
  group_by(city, response) %>% 
  tally() %>% 
  ungroup() %>% 
  mutate(city = fct_reorder(city, n)) %>% 
  ggplot(., aes(x = city, y = n, fill = response)) +
  geom_bar(stat = "identity")+
  coord_flip()


```

# Gender
```{r}
library(stringr)
library(reshape2)
# library(statR)



vornamen <- readxl::read_xlsx("vornamen_geschlecht.xlsx") %>% 
  mutate(female  = as.numeric(female),
         male = as.numeric(male))

gender_guess <- vornamen %>% 
  mutate_all(funs(replace(., is.na(.), 0))) %>% 
  group_by(name) %>% 
  mutate(tot = sum(male, female, na.rm = T)) %>% 
  mutate(prob_female = ifelse(is.na(female) == F, female/tot, male/tot)) %>% 
  select(name, prob_female)
  
  
  # melt(id ="name") %>% 
  # group_by(name) %>% 
  # mutate(tot = sum(value, na.rm = T),
  #        n_female = value[variable == "female"],
  #        n_male = value[variable == "male"]) %>% 
  # # mutate(typ = ifelse(tot == n_female , "female",
  # #                     ifelse(tot == n_male, "male", "both"))) %>% 
  # mutate(prob_female = n_female/tot) %>% 
  # ungroup() %>% 
  # filter(variable == "female")

gender <- adminr_guests %>% 
  mutate(name = sub("\\s.*","",member_name)) %>% 
  left_join(., gender_guess, by = c('name' = 'name')) %>% 
  mutate(gender = ifelse(prob_female >= 0.5, "female", "male"))

gender_freq <- gender %>% 
  group_by(name, gender) %>% 
  summarise(n = n()) %>% 
  ungroup()


gender %>% 
  ggplot(., aes(x = gender, fill = gender))+
  geom_bar()


# wordcloud::wordcloud(gender_freq$name,freq = gender_freq$n, min.freq = 1)

```

# Answers
```{r}

library(purrr)
library(repurrrsive)

mem_list <- adminr_members$resource %>% unlist(.$group_profile) %>% data_frame() %>% select(group_profile.answers.answer)
names(mem_list)


%>% filter(id == 189064954)





ttt <- data.frame(id = c(rep(NA, length(n_members))) , answer1 = c(rep(NA, length(n_members))), answer2 = c(rep(NA, length(n_members))))

for (i in 1:length(n_members)){
  
  if (is.null(adminr_members$resource[[i]]$group_profile$answers[[1]]$answer) == F ){
    
    t <- data_frame(id = adminr_members$resource[[i]]$id, 
           answer1 = adminr_members$resource[[i]]$group_profile$answers[[1]]$answer,
           answer2 = adminr_members$resource[[i]]$group_profile$answers[[2]]$answer)
    
  } else
    t <- data_frame(id = adminr_members$resource[[i]]$id, answer1 = NA, answer2 = NA)
  
t2 <- t

ttt[i,] <- t2

}


ids <- left_join(ids, ttt, by = 'id')

# rm(t, t2, tt)

```

```{r}
map(got_chars[1:3], "name")

ids <- map_dfr(adminr_members$resource, extract, c("id", "name"))

t_id <- map(adminr_members$resource[1:3], extract, c("id", "name", "group_profile"))

t_group_profile <- map(adminr_members$resource[1:3], "group_profile")

t_group_profile[[1:3]]$answers[[2]]$answer

t_answers <- map(t_group_profile[1:3], "answers")

map(t_answers[1:3], "answer[1]")


adminr_members$resource[1:3]$group_profile$answers

t <- adminr_members %>% unnest(resource)


data <- adminr_members %>% select(resource)

t <- data %>% unnest(resource)

t %>% filter(grepl("answer", resource))

```

